{% extends "base.html" %}

{% block header %}
    <title>{{ channel.metadata.title }} - Invidious</title>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed/channel/{{ channel.metadata.external_id }}" />
{% endblock header %}
{% block content %}

{%if channel.banner.is_some() %}
    <div class="h-box">
        <img style="width:100%" src="{{ channel.banner.as_ref().unwrap().clone() }}">
    </div>
    <div class="h-box">
        <hr>
    </div>
{% endif %}

<div class="pure-g h-box">
    <div class="pure-u-2-3">
        <div class="channel-profile">
            <img src="{{ channel.thumbnail }}">
            <span>{{ channel.metadata.title }}</span>
            {% match channel.header.badges %}
                {% when Some with (badges) %}
                    {% if youtubei_rs::utils::get_author_verified(badges.get(0).unwrap().metadata_badge_renderer) %}
                        <i class="icon ion ion-md-checkmark-circle"></i>
                    {% endif %}
                {% when None %}
            {% endmatch %}
        </div>
    </div>
    <div class="pure-u-1-3">
        <h3 style="text-align:right">
            <a href="/feed/channel/{{ channel.metadata.external_id }}"><i class="icon ion-logo-rss"></i></a>
        </h3>
    </div>
</div>

<div class="h-box">
    <div id="descriptionWrapper">
        {% match channel.about.description %}
            {% when Some with (desc) %}
                <p><span style="white-space:pre-wrap">{{ desc.simple_text }}</span></p>
            {% when None %}
        {% endmatch %}
    </div>
</div>

<div class="h-box">
    {% if channel.header.subscriber_count_text.is_some() %}
        {% let sub_count_text = channel.header.subscriber_count_text.as_ref().unwrap().simple_text.clone() %}
        {% let channel_id = channel.metadata.external_id.clone() %}
        {% let author = channel.metadata.title.clone() %}
        {% include "common/subscribe_widget.html" %}
    {% else %}
        {% let channel_id = channel.metadata.external_id.clone() %}
        {% let author = channel.metadata.title.clone() %}
        {% let sub_count_text = 0 %}
        {% include "common/subscribe_widget.html" %}
    {% endif %}
</div>


<div class="pure-g h-box">
    <div class="pure-u-1-3">
        <a href="https://www.youtube.com/channel/{{ channel.metadata.external_id }}">{{ localize("view_channel_on_youtube") }}</a>
        <div class="pure-u-1 pure-md-1-3">
            {% if context.preferences.automatic_instance_redirect %}
                <a href="/redirect?referer={{ context.current_page }}">{{ localize("switch_invidious_instance") }}</a>
            {% else %}
                <a href="https://redirect.invidious.io{{ context.current_page }}">{{ localize("switch_invidious_instance") }}</a>
            {% endif %}
        </div>
        {% if !channel.auto_generated %}
            <div class="pure-u-1 pure-md-1-3">
                <b>{{ localize("videos") }}</b>
            </div>
        {% endif %}
        <div class="pure-u-1 pure-md-1-3">
            {% if channel.auto_generated %}
                <b>{{ localize("playlists") }}</b>
            {% else %}
                <a href="/channel/{{ channel.metadata.external_id }}/playlists">{{ localize("playlists") }}</a>
            {% endif %}
        </div>
        <div class="pure-u-1 pure-md-1-3">
            {% if channel.has_community_enabled %}
                <a href="/channel/{{ channel.metadata.external_id }}/community">{{ localize("community") }}</a>
            {% endif %}
        </div>
    </div>
    <div class="pure-u-1-3"></div>
    <div class="pure-u-1-3">
        <div class="pure-g" style="text-align:right">
            {% for sort in channel.sort_options %}
                <div class="pure-u-1 pure-md-1-3">
                    {% if channel.sorted_by == sort.to_owned() %}
                        <b>{{ localize(sort.as_str()) }}</b>
                    {% else %}
                        <a href="/channel/{{ channel.metadata.external_id }}?&sort_by={{ sort }}">
                            {{ localize(sort.as_str()) }}
                        </a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="h-box">
    <hr>
</div>

<div class="pure-g">
    <div class="pure-u-1 pure-u-md-1-4">
        <div class="h-box">
    {% for content in channel.items %}
                {% match content %}
                    {% when youtubei_rs::types::enums::ItemSectionRendererContents::GridChannelRenderer with (item) %}
                        {% include "common/renderers/gridChannelRenderer.html" %}
                    {% when youtubei_rs::types::enums::ItemSectionRendererContents::GridPlaylistRenderer with (item) %}       
                        {% include "common/renderers/gridPlaylistRenderer.html" %}
                    {% when youtubei_rs::types::enums::ItemSectionRendererContents::GridRadioRenderer with (item) %}
                        {% include "common/renderers/gridRadioRenderer.html" %}
                    {% when  youtubei_rs::types::enums::ItemSectionRendererContents::GridVideoRenderer with (item) %}
                        {% include "common/renderers/gridVideoRenderer.html" %}
                    {% when  youtubei_rs::types::enums::ItemSectionRendererContents::GridRenderer with (item) %}
                        {% include "common/renderers/gridRenderer.html" %}
                    {% when  youtubei_rs::types::enums::ItemSectionRendererContents::BackstagePostThreadRenderer with (item) %}
                        {% match item.post %}
                            {% when  youtubei_rs::types::enums::CommunityPost::SharedPostRenderer with (post) %}
                                {% include "common/renderers/sharedPostRenderer.html" %}
                            {% when  youtubei_rs::types::enums::CommunityPost::BackstagePostRenderer with (post) %}
                                {% include "common/renderers/backstagePostRenderer.html" %}
                            {% endmatch %}
                    {% else %}
                        {{format!("{:?}", content)}}
                {% endmatch %}
                {% endfor %}
            </div>
        </div>
</div>

<div class="pure-g h-box">
    <div class="pure-u-1 pure-u-lg-1-5">
        <a href="/channel/{{ channel.metadata.external_id }}?{% if channel.sorted_by != "newest" %}&sort_by={{ channel.sorted_by }}{% endif %}">
            {{ localize("previous_page") }}
        </a>
    </div>
    <div class="pure-u-1 pure-u-lg-3-5"></div>
    <div class="pure-u-1 pure-u-lg-1-5" style="text-align:right">
        <a href="/channel/{{ channel.metadata.external_id }}?{% if channel.sorted_by != "newest"%}&sort_by={{ channel.sorted_by }}{% endif %}">
            {{ localize("next_page") }}
        </a>
    </div>
</div>
{% endblock content %}